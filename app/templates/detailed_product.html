{% extends "base.html" %}

{% block content %}
  <div class="container mt-5">
    <h2>{{ name }} Details</h2>

    <div class="row">
      <div class="col-md-6">
        <img src="{{ image_url }}" alt="{{ name }} Image" class="img-fluid">
      </div>
      <div class="col-md-6">
        <p><strong>Description:</strong> {{ description }}</p>
        <p><strong>Price:</strong> ${{ price }}</p>
        <p><strong>Category:</strong> {{ category }}</p>
        <p>
          <strong>Availability:</strong>
          <span class="{% if available %}text-success{% else %}text-danger{% endif %}">
            {% if available %}
              In Stock
            {% else %}
              Out of Stock
            {% endif %}
          </span>
        </p>
        <p><strong>Average Rating:</strong> {{ '{:.2f}/5'.format(avg_stars) if avg_stars is not none else 'Not rated' }}</p>
        <p><strong>Number of Ratings:</strong> {{ '{:.0f}'.format(num_ratings) if num_ratings is not none else '0' }}</p>
      </div>
    </div>
    <br>
    <h3>Sellers and Stock Quantities</h3>
        <table class="table">
        <thead>
            <tr>
            <th scope="col">Seller ID</th>
            <th scope="col">Seller Name</th>
            <th scope="col">Quantity in Stock</th>
            </tr>
        </thead>
        <tbody>
            {% for seller in seller_info %}
            <tr>
                <td>{{ seller.uid }}</td>
                <td>{{ seller.name }}</td>
                <td>{{ seller.quantity }}</td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
  </div>
  <h2>Reviews:</h2>
  {% if allowed == 1 %}
    {% if reviewed_allowed == 1 %}
    <div class="add-review-button">
        <a href="{{ url_for('product_rating.redirect_to_add_review', pid=pid) }}" class="btn btn-primary">Add Review</a>
    </div>
    {% else %}
      <p class="message">You can only add one review per product.</p>
      <h2>My Review:</h2>
      <table class='table table-hover table-bordered container'>
        <thead class="thead-dark">
          <tr>
            <th scope="col">Reviewer Name</th>
            <th scope="col">Stars</th>
            <th scope="col">Description</th>
            <th scope="col">Upvotes</th>
            <th scope="col">Downvotes</th>
            <th scope="col">Time Reviewed</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
      
        <tbody>
          {% for rating in user_rating_info%}
            <tr>
              <td>{{rating.firstname}} {{rating.lastname}}</td>
              <td>{{rating.stars}}</td>
              <td>{{rating.description}}</td>
              <td>{{rating.upvotes}}</td>
              <td>{{rating.downvotes}}</td>
              <td>{{rating.time_reviewed}}</td>
              <td>
                <a href="{{ url_for('product_rating.redirect_to_edit_review', pid=rating.pid) }}" class="btn btn-light">Edit Review</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>  
    {% endif %}  
  {% else %}
    <p class="message">You can only add a review if you have bought the product.</p>
  {% endif %}
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <tr>
      <th scope="col">Reviewer Name</th>
      <th scope="col">Stars</th>
      <th scope="col">Description</th>
      <th scope="col">Upvotes</th>
      <th scope="col">Downvotes</th>
      <th scope="col">Time Reviewed</th>
    </tr>
  </thead>

  <tbody>
    {% for rating in rating_info%}
      <tr>
        <td>{{rating.firstname}} {{rating.lastname}}</td>
        <td>{{rating.stars}}</td>
        <td>{{rating.description}}</td>
        <td>{{rating.upvotes}}</td>
        <td>{{rating.downvotes}}</td>
        <td>{{rating.time_reviewed}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<nav aria-label="Page navigation">
  <ul class="pagination">
    {% set total_pages = (total // per_page) + (1 if total % per_page > 0 else 0) %}
    {% for p in range(1, total_pages + 1) %}
    <li class="page-item {% if p == page %}active{% endif %}">
      <a class="page-link" href="{{ url_for('products.product_details', pid=pid, page=p) }}">{{ p }}</a>
    </li>
    {% endfor %}
  </ul>
</nav>
{% endblock %}
